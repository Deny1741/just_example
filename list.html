<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script
            src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
            crossorigin="anonymous"></script>
    <script
            src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"
            integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30="
            crossorigin="anonymous"></script>
    <title>Ментальная арифметика</title>
</head>

<style>
    :root {
        --nav-link-color: #008CBA;
        --nav-link-color-hover: #ff3366;
        --nav-link-text-color: #fff;
        --btn-color-green: #4CAF50;
        --btn-color-blue: #008CBA;
        --form-background: #323a45;
        --btn-form-color: #ff3366;
    }

    * {
        margin: 0;
        padding: 0;
    }

    body {
        font-family: Helvetica, serif;
        max-width: 1200px;
        margin: 0 auto;
        padding-right: 5px;
        padding-left: 5px;
        line-height: 1.5;
        font-size: 16px;
    }

    ul {
        list-style-type: none;
    }

    @media screen and (max-width: 680px) {
        .nav {
            margin-bottom: 20px !important;
        }
        .nav-item, .settings-item, .button, .form-item {
            width: 100% !important;
        }
    }

    @media screen and (max-width: 500px) {
        .nav {
            margin-bottom: 20px !important;
        }
        .nav-item, .settings-item, .button, .form-item {
            width: 100% !important;
        }
        .mobile-count {
            width: calc(33% - 10px) !important;

        }

        .wrap-sky, .wrap-earth {
            width: 300px !important;
            padding-right: 30px !important;

        }

        .flexible {
            display: none !important;
        }

    }



    #numbers {
        min-height: 200px;
        min-width: 300px;
        display: flex;
    // flex-direction: column;
    // justify-content: center;
        justify-content: space-between;
        align-items: center;
        font-weight: bold;
        font-size: 32px;
    }

    #soroban-trainer {
        display: none;
        margin-top: 10px;
        margin-bottom: 40px;
    }

    .wrap {
        display: flex;
        flex-direction: column;
     //   border: #ff3366 solid 2px;
        align-items: center;
        justify-content: center;
    }

    /* Настройки */

    .settings {
        width: 100%;
     //   border: 1px solid #4CAF50;
    }

    .settings ul  {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        list-style-type: none;
    }

    .settings-item {
        width: calc(20% - 20px);

        text-align: center;
        margin: 5px;
        font-weight: bold;
        font-size: 1.2rem;
    }

    .settings label {
        display: block;
    }

    .settings-item input, select {
        display: block;
        border: 2px solid cornflowerblue;
        text-align: center;
        border-radius: 3px;
        font-size: 1.2rem;
        font-weight: bold;
        width: 100%;
        text-align-last:center;
    }

    option {
        text-align-last:center;
    }

    option {
        text-align: center;
    }

    /* число */

    .number {
        font-size: 48px;
        font-weight: bold;
        text-align: center;
        width: 100%;
        padding: 10px;
        border: 1px solid black
    }

    .answer {
        text-align: center;
        border-radius: 3px;
        border: 2px solid cornflowerblue;
        cursor: pointer;
        font-size: 2rem;
        padding-top: 10px;
        padding-bottom: 10px;
        width: calc(100% - 12px);
        margin-bottom: 15px;
    }

    .button-group {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        width: 100%;
    }

    .button {
        color: white;
        text-align: center;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 1.5rem;
        font-weight: bold;
        padding-top: 10px;
        padding-bottom: 10px;
        margin: 5px;
        text-transform: uppercase;
        width: calc(50% - 15px);
    }

    .green {
        background-color: var(--btn-color-green);
    }

    .blue {
        background-color: var(--btn-color-blue);
    }


    /* Переключатель */

    /* The switch - the box around the slider */

    .switch-wrap {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 30px;
    }
    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 30px;
    }

    /* Hide default HTML checkbox */
    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    /* The slider */
    .slider {
        position: absolute;
        cursor: pointer;
        top: 15px;
        left: 0;
        right: 0;
        bottom: -15px;
        background-color: #ccc;
        -webkit-transition: .4s;
        transition: .4s;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        -webkit-transition: .4s;
        transition: .4s;
    }

    input:checked + .slider {
        background-color: #2196F3;
    }

    input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
    }

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

    .slider.round:before {
        border-radius: 50%;
    }

    /* Соробан */

    .wrap-sky {
        position: relative;
        display: flex;
        flex-direction: row-reverse;
        justify-content: space-evenly;
        width: 800px;
        height: 100px;
        border: 3px solid black;
        margin: 0 auto;
    }

    .wrap-earth {
        position: relative;
        display: flex;
        flex-direction: row-reverse;
        justify-content: space-evenly;
        width: 800px;
        height: 220px;
        border: 3px solid black;
        margin: 0 auto;
    }

    .column {
        border-right: 2px solid black;
        width: 35px;
    }

    .box {
        position: absolute;
        background-image: url("img/bead_inactive.png");
        background-size: 100%;
        background-position: center center; /* Положение фона */
        background-repeat: no-repeat; /* Отменяем повторение фона */
        bottom: 0;
        margin: 0;
    //    border: 1px solid green;
        width: 70px;
        height: 40px;
    }

    .sky {
    //  background-image: url("img/bead_active.png");
        top: 20px;
    }

</style>
<body>
<div class="wrap">
    <div class="settings">
        <ul>
            <li class="settings-item">
                <label for="select_level">Выбрать ступень: </label>
                <select id="select_level">
                    <option value="0">1</option>
                    <option value="1">2</option>
                    <option value="2">3</option>
                </select>
            </li>

            <li class="settings-item">
                <label for="select_page">Выбрать страницу: </label>
                <select id="select_page"></select>
            </li>

            <li class="settings-item mobile-count">
                <label for="select_page">Пример: </label>
                <div id="current"></div>
            </li>

            <li class="settings-item mobile-count">
                <label for="select_page">Правильно: </label>
                <div id="completed"></div>
            </li>

            <li class="settings-item mobile-count">
                <div class="switch-wrap" itemtype="switcher">
                    <label class="switch" itemtype="switcher">
                        <input type="checkbox">
                        <span class="slider round" id="switcher"></span>
                    </label>
                </div>
            </li>
        </ul>
    </div>
    <div id="numbers">Выберите сложность и нажмите "Новый пример"</div>

    <!-- Соробан -->

    <div id="soroban-trainer">
        <div id="soroban-5" class="wrap-sky">

            <div class="column">
                <div id="05" class="box sky"></div>
            </div>

            <div class="column">
                <div id="15" class="box sky"></div>
            </div>

            <div class="column">
                <div id="25" class="box sky"></div>
            </div>

            <div class="column flexible">
                <div id="35" class="box sky"></div>
            </div>

            <div class="column flexible">
                <div id="45" class="box sky"></div>
            </div>

            <div class="column flexible">
                <div id="55" class="box sky"></div>
            </div>
        </div>

        <div id="soroban" class="wrap-earth">
            <div class="column">
                <div id="03" class="box"></div>
                <div id="02" class="box"></div>
                <div id="01" class="box"></div>
                <div id="00" class="box"></div>
            </div>

            <div class="column">
                <div id="13" class="box"></div>
                <div id="12" class="box"></div>
                <div id="11" class="box"></div>
                <div id="10" class="box"></div>
            </div>

            <div class="column">
                <div id="23" class="box"></div>
                <div id="22" class="box"></div>
                <div id="21" class="box"></div>
                <div id="20" class="box"></div>
            </div>

            <div class="column flexible">
                <div id="33" class="box"></div>
                <div id="32" class="box"></div>
                <div id="31" class="box"></div>
                <div id="30" class="box"></div>
            </div>

            <div class="column flexible">
                <div id="43" class="box"></div>
                <div id="42" class="box"></div>
                <div id="41" class="box"></div>
                <div id="40" class="box"></div>
            </div>

            <div class="column flexible">
                <div id="53" class="box"></div>
                <div id="52" class="box"></div>
                <div id="51" class="box"></div>
                <div id="50" class="box"></div>
            </div>
        </div>
    </div>

    <input id="input-answer" type="number" class="answer" placeholder="введите ответ">
    <div class="button-group">
        <button class="button green" id="answer">Ответить</button>
        <button class="button blue" id="start">Новый пример</button>
    </div>


</div>

</body>

<script>
    let index = 0;
    let right_counter = 0;
    let current_counter = 0;
    let toggle_soroban = false;
    let page_amount = 0;


    let level_1 = [
        [
            [1, 1, -1, 1], [1, 2, -1, 2], [2, 1, -2, 1], [3, -2, 2, 3], [3, -3, 3, 3], [4, -3, 2, 3], [4, -4, 3, 3], [4, -2, 1, 3], [4, -4, 4, 4], [4, -2, 2, 4],
            [1, -1, 2, -1, 1], [3, -3, 4, -2, 2], [3, 1, -2, -2, 0], [4, -3, 2, 1, 4], [4, -3, 1, 2, 4], [2, -2, 4, -2, 2], [2, -2, 3, 1, 4], [3, 1, -2, 1, 3], [3, -2, 1, 2, 4], [1, 3, -1, -3, 0],
            [3, 1, -2, 1, 1, 4], [4, -3, 1, 2, -4, 0], [4, -2, 2, -1, -3, 0], [3, -1, -2, 2, 2, 4], [1, -1, 4, -2, 1, 3], [3, -2, 2, -3, 4, 4], [1, 2, -1, 2, -4, 0], [1, 3, -2, 1, 1, 4], [2, -1, 3, -4, 1, 1], [3, -2, 3, -2, -2, 0]
        ],
        [
            [1, 1, 1, 3], [1, -1, 2, 2], [4, -1, 1, 4], [3, -1, 2, 4], [3, -2, 3, 4], [2, 2, -1, 3], [3, -3, 2, 2], [1, 3, -1, 3], [3, -1, 2, 4], [4, -3, 1, 2],
            [2, -1, 2, 1, 4], [4, -3, 2, 1, 4], [1, 3, -2, -2, 0], [2, 2, -3, 3, 4], [4, -3, 2, 1, 4], [2, -1, 3, -2, 2], [2, -2, 4, -2, 2], [3, 1, -2, -1, 1], [3, -1, -2, 4, 4], [1, 3, -1, -2, 1],
            [1, 3, -2, 1, 1, 4], [4, -4, 1, 2, 1, 4], [2, 2, -4, 2, 2, 4], [4, -1, -2, 2, 1, 4], [1, -1, 3, 1, -4, 0], [3, -2, 2, 1, -3, 1], [2, 1, -1, 2, -4, 0], [3, 1, -2, -1, 3, 4], [3, -2, 1, 2, -1, 3], [3, -1, 2, -2, -1, 1]
        ],
    ];

    let level_2 = [
        [
            [9, 1, 10], [2, 7, 1, 10], [9, 1, 2, 12], [8, 1, 1, 10], [5, 4, 1, 10], [9, 1, 4, 14], [6, 3, 1, 10], [9, 1, 5, 15], [3, 6, 4, 13], [9, 1, 6, 16],
            [ 11, 3, 5, 1, 20], [32, 2, 5, 1, 40], [21, 5, 3, 1, 30], [17, 1, 1, 1, 20], [86, 2, 1, 1, 90], [53, 5, 1, 1, 60], [65, 3, 1, 1, 70], [15, 2, 2, 1, 20], [16, 3, 1, 1, 21], [28, 1, 1, 4, 34],
            [ 21, 7, 1, 1, 2, 32], [32, 7, 1, 1, 5, 46], [13, 6, 1, 2, 2, 24], [44, 5, 1, 3, -2, 51], [35, 4, 1, 4, -2, 42], [56, 3, 1, 5, 3, 68], [77, 2, 1, 5, 4, 89], [88, 1, 1, 8, -6, 92], [69, 1, 6, 2, -5, 73], [59, 1, 4, -2, 7, 69],
            [ 8, 1, 1, 3, 1, -2, 12], [9, 1, 5, -5, 6, -1, 15], [9, 1, 4, -3, 2, 5, 18], [1, 6, 2, 1, 8, -6, 12], [1, 5, 3, 1, 9, -3, 16], [2, 2, 5, 1, 7, -5, 12], [2, 7, 1, 3, -2, 3, 14], [3, 6, 1, 5, 3, -8, 10], [4, 5, 1, 2, -1, 8, 19], [2, -1, 8, 1, 4, 5, 19]
        ],
        [
            [11, 8, 1, 20], [18, 1, 1, 20], [29, 1, 3, 33], [53, 6, 1, 60], [55, 4, 1, 60], [29, 1, 7, 37], [59, 1, 6, 66], [37, 2, 1, 40], [59, 1, 3, 63], [86, 3, 1, 90],
            [ 42, 2, 5, 1, 50], [72, 5, 2, 1, 80], [83, 5, 1, 1, 90], [21, 7, 1, 1, 30], [19, 1, 1, 4, 25], [34, 4, 1, 1, 40], [13, 5, 1, 1, 20], [55, 2, 2, 1, 60], [56, 2, 1, 1, 60], [21, 8, 1, 1, 31],
            [ 81, 7, 1, 1, 3, 93], [72, 7, 1, 1, 5, 86], [53, 6, 1, 11, 2, 73], [14, 5, 1, 23, 6, 49], [35, 4, 1, 2, 7, 49], [26, 3, 1, 3, -2, 31], [12, 7, 1, 5, 3, 28], [8, 1, 1, 15, 3, 28], [9, 1, 3, -2, 17, 28], [29, 1, 4, -1, -12, 21],
            [ 1, 8, 1, 6, 6, -5, 17], [9, 1, 4, 7, 7, -2, 26], [9, 1, 9, 2, 2, -6, 17], [1, 6, 2, 8, 8, -3, 22], [5, 1, 3, 4, 4, 3, 20], [5, 2, 2, 3, 3, 2, 17], [1, 7, 2, 5, 5, -7, 13], [3, 6, 1, -3, -3, 1, 5], [39, 5, 3, 11, 11, 2, 71], [8, -1, 2, 4, 4, 1, 18],
        ],
    ];


    notebook_nums = [level_1, level_2];


    page_amount = notebook_nums[$('#select_level').val()].length;

    // Генерирование настроек
    for (let i = 1; i <= page_amount; i++) {
        document.getElementById('select_page').innerHTML += `<option value="${i}">${i}</option>`
    }

    let arr_nums = notebook_nums[document.getElementById('select_level').value][document.getElementById('select_page').value - 1];


    // for (let i = 0; i < arr_nums[index].length - 1; i++) {document.getElementById('numbers').innerHTML += `<div class="number"> ${arr_nums[index][i]} </div>`}

   // console.log(notebook_nums[0][1]);


    // Генерирование примеров

    document.getElementById('select_page').onchange = () => {
        index = 0;
        right_counter = 0;
        current_counter = 0;
        arr_nums = notebook_nums[document.getElementById('select_level').value][document.getElementById('select_page').value - 1];
      //  console.log(arr_nums);

        document.getElementById('completed').innerText = `${right_counter} из ${arr_nums.length}`;
    };

    document.getElementById('select_level').onchange = () => {
        index = 0;
        right_counter = 0;
        current_counter = 0;
        arr_nums = notebook_nums[document.getElementById('select_level').value][document.getElementById('select_page').value - 1];

        page_amount = notebook_nums[$('#select_level').val()].length;

        // Генерирование настроек
        document.getElementById('select_page').innerHTML = '';
        for (let i = 1; i <= page_amount; i++) {
            document.getElementById('select_page').innerHTML += `<option value="${i}">${i}</option>`
        }
     //   console.log(arr_nums);

        document.getElementById('completed').innerText = `${right_counter} из ${arr_nums.length}`;
    };



    start = () => {
        soroban_clear();
        document.getElementById('answer').disabled = false;
        document.getElementById('input-answer').disabled = false;

        document.getElementById('numbers').style.color = 'black';
        document.getElementById('input-answer').value = '';
        if (index >= arr_nums.length) document.getElementById('numbers').innerText = `Правильно: ${right_counter} из ${arr_nums.length}`;
        else document.getElementById('numbers').innerHTML = '';
        for (let i = 0; i < arr_nums[index].length - 1; i++) {
            document.getElementById('numbers').innerHTML += `<div class="number"> ${arr_nums[index][i]} </div>`
        }
        index++;
        current_counter++;
        document.getElementById('current').innerText = `${current_counter} из ${arr_nums.length}`;

        //   if (index === arr_nums.length - 1) document.getElementById('start').disabled = true;

    };

    answer = () => {
        if (document.getElementById('input-answer').value === arr_nums[index - 1][arr_nums[index - 1].length - 1].toString() || sum === arr_nums[index - 1][arr_nums[index - 1].length - 1]) {
            document.getElementById('input-answer').value = '';
            document.getElementById('numbers').style.color = 'var(--btn-color-green)';
            right_counter++;

            document.getElementById('answer').disabled = true;
            document.getElementById('input-answer').disabled = true;
        }
        else {
            document.getElementById('numbers').style.color = 'var(--btn-form-color)';
        }

        document.getElementById('completed').innerText = `${right_counter} из ${arr_nums.length}`;

    };

    document.getElementById('switcher').onclick = () => {
        toggle_soroban = toggle_soroban !== true;
        if (toggle_soroban === true) {
            document.getElementById('soroban-trainer').style.display = 'block';
            document.getElementById('input-answer').style.display = 'none'
        }
        else {
            document.getElementById('soroban-trainer').style.display = 'none';
            document.getElementById('input-answer').style.display = 'block';
        }
    };

    document.getElementById('start').onclick = () => start();
    document.getElementById('answer').onclick = () => answer();
    document.getElementById('input-answer').onkeypress = () => { if (event.keyCode === 13) answer(); };


    // Соробан

    let toggle_bead = [[false, false, false, false], [false, false, false, false], [false, false, false, false], [false, false, false, false], [false, false, false, false], [false, false, false, false]];
    let toggle_bead_5 = [[false], [false], [false], [false], [false], [false]];
    let sum = 0;

    let bottom = 20;

    for (let i = 3; i >= 0; i--) {
        $(`#0${i}`).css('bottom', bottom);
        $(`#1${i}`).css('bottom', bottom);
        $(`#2${i}`).css('bottom', bottom);
        $(`#3${i}`).css('bottom', bottom);
        $(`#4${i}`).css('bottom', bottom);
        $(`#5${i}`).css('bottom', bottom);
        bottom += 40;
    }

    $('#soroban').click((event) => {
        let x = 0;
        let y = 0;

        x = $(`#${event.target.id}`).prop('id')[0];
        y = $(`#${event.target.id}`).prop('id')[1];

        //   toggle_bead[x][y] = toggle_bead[x][y] !== true;
        //   move_bead(x, y);

        if (toggle_bead[x][y] === false) {
            for (let i = y; i >= 0; i--) {
                toggle_bead[x][i] = true;
                if ((parseInt($(`#${x}${i}`).css('bottom')) % 10 === 0)) {
                    $(`#${x}${i}`).css('background-image', 'url("img/bead_active.png")');
                    move_bead(x, i);
                }
            }
        }

        else if (toggle_bead[x][y] === true) {
            for (let i = y; i < 4; i++) {
                toggle_bead[x][i] = false;
                if (!(parseInt($(`#${x}${i}`).css('bottom')) % 10 === 0)) {
                    $(`#${x}${i}`).css('background-image', 'url("img/bead_inactive.png")');
                    move_bead(x, i);
                }
            }
        }

        console.log(sum);
        //   answer();



        //  console.log(($(`#${x}${y}`)).css('background', 'black'));
    });

    const move_bead = (x, y) => {
        let temp_bottom = 0;
        if (toggle_bead[x][y] === true) {
            temp_bottom = parseInt($(`#${x}${y}`).css('bottom')) + 35;
            sum += 10 ** parseInt(`${x}`);
        }
        if (toggle_bead[x][y] === false) {
            temp_bottom = parseInt($(`#${x}${y}`).css('bottom')) - 35;
            sum -= 10 ** parseInt(`${x}`);
        }
        $(`#${x}${y}`).css('bottom', temp_bottom);
    };

    $('#soroban-5').click((event) => {
        let x = 0;
        let y = 0;

        x = $(`#${event.target.id}`).prop('id')[0];
        y = $(`#${event.target.id}`).prop('id')[1];

        toggle_bead_5[x][y] = toggle_bead_5[x][y] !== true;

        let temp_bottom = 0;

        if (toggle_bead_5[x][y] === true) {
            $(`#${x}${y}`).css('background-image', 'url("img/bead_active.png")');
            temp_bottom = parseInt($(`#${x}${y}`).css('top')) + 35;
            sum += 10 ** parseInt(`${x}`)*5;
        }

        if (toggle_bead_5[x][y] === false) {
            $(`#${x}${y}`).css('background-image', 'url("img/bead_inactive.png")');
            temp_bottom = parseInt($(`#${x}${y}`).css('top')) - 35;
            sum -= 10 ** parseInt(`${x}`)*5;
        }
        $(`#${x}${y}`).css('top', temp_bottom);

        console.log(sum);
        //  answer();

    });

    const soroban_clear = () => {
        toggle_bead = [[false, false, false, false], [false, false, false, false], [false, false, false, false], [false, false, false, false], [false, false, false, false], [false, false, false, false]];
        toggle_bead_5 = [[false], [false], [false], [false], [false], [false]];
        sum = 0;

        let bottom = 20;

        for (let i = 3; i >= 0; i--) {
            $(`#0${i}`).css('bottom', bottom).css('background-image', 'url("img/bead_inactive.png")');
            $(`#1${i}`).css('bottom', bottom).css('background-image', 'url("img/bead_inactive.png")');
            $(`#2${i}`).css('bottom', bottom).css('background-image', 'url("img/bead_inactive.png")');
            $(`#3${i}`).css('bottom', bottom).css('background-image', 'url("img/bead_inactive.png")');
            $(`#4${i}`).css('bottom', bottom).css('background-image', 'url("img/bead_inactive.png")');
            $(`#5${i}`).css('bottom', bottom).css('background-image', 'url("img/bead_inactive.png")');
            bottom += 40;
        }

        for (let i = 0; i < 6; i++) {
            $(`#${i}${5}`).css('top', 20).css('background-image', 'url("img/bead_inactive.png")');
        }
    }

    // Мобильная версия



</script>
</html>